use crate::types::{Color, Piece, Square};

#[derive(Debug, Default, Clone, Copy)]
pub struct Evaluation {
    mg: i32,
    eg: i32,
}

impl Evaluation {
    /// Adds the score of a piece at a given square to the current scores using the PSQT.
    pub fn add_piece(&mut self, piece: Piece, color: Color, square: Square) {
        let (mg, eg) = get_bonus(piece, color, square);
        self.mg += mg;
        self.eg += eg;
    }

    /// Subtracts the score of a piece at a given square from the current scores using the PSQT.
    pub fn remove_piece(&mut self, piece: Piece, color: Color, square: Square) {
        let (mg, eg) = get_bonus(piece, color, square);
        self.mg -= mg;
        self.eg -= eg;
    }

    /// Returns the current evaluation scores for both middle game and end game phases.
    pub const fn score(self) -> (i32, i32) {
        (self.mg, self.eg)
    }
}

fn get_bonus(piece: Piece, color: Color, square: Square) -> (i32, i32) {
    match color {
        Color::White => {
            let index = piece as usize * 64 + (square.0 as usize ^ 56);
            PSQT[index]
        }
        Color::Black => {
            let index = piece as usize * 64 + square.0 as usize;
            (-PSQT[index].0, -PSQT[index].1)
        }
    }
}

#[rustfmt::skip]
const PSQT: [(i32, i32);  6 * 64] = [
    (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0),
    (194, 349), (242, 305), (202, 338), (232, 277), (201, 283), (200, 278), (118, 333), ( 73, 352),
    (106, 275), (119, 293), (152, 250), (156, 224), (164, 213), (191, 197), (169, 253), (106, 250),
    ( 89, 179), (108, 173), (106, 148), (110, 135), (137, 127), (120, 134), (125, 158), ( 99, 154),
    ( 76, 143), ( 98, 149), ( 96, 125), (117, 125), (118, 122), (104, 124), (105, 140), ( 84, 124),
    ( 77, 133), ( 93, 145), ( 93, 124), ( 95, 138), (114, 134), ( 95, 130), (130, 137), ( 98, 118),
    ( 77, 142), ( 96, 152), ( 86, 133), ( 78, 138), ( 99, 155), (120, 139), (146, 136), ( 86, 122),
    (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0),
    
    (179, 307), (237, 364), (305, 383), (331, 373), (373, 379), (298, 355), (285, 356), (260, 264),
    (340, 361), (381, 376), (413, 386), (429, 390), (419, 372), (505, 354), (396, 364), (430, 324),
    (363, 383), (426, 387), (455, 407), (473, 405), (518, 388), (519, 385), (469, 372), (428, 354),
    (373, 379), (396, 404), (431, 424), (468, 422), (442, 424), (478, 416), (420, 403), (430, 369),
    (359, 379), (378, 401), (410, 421), (415, 421), (431, 424), (420, 410), (413, 397), (379, 362),
    (334, 355), (368, 377), (394, 387), (401, 413), (420, 407), (404, 380), (402, 370), (361, 355),
    (318, 348), (332, 369), (358, 377), (383, 374), (384, 374), (388, 372), (361, 355), (359, 354),
    (254, 331), (334, 310), (315, 357), (343, 359), (346, 359), (364, 342), (338, 325), (293, 337),
    
    (360, 392), (339, 399), (337, 398), (258, 424), (316, 407), (333, 391), (353, 385), (336, 382),
    (381, 375), (414, 388), (400, 391), (388, 389), (417, 381), (423, 377), (426, 385), (414, 363),
    (401, 403), (429, 391), (428, 397), (456, 382), (437, 387), (479, 392), (467, 385), (455, 387),
    (398, 396), (409, 404), (429, 402), (450, 412), (447, 404), (439, 400), (415, 398), (409, 391),
    (399, 382), (395, 406), (406, 404), (434, 406), (434, 403), (408, 399), (402, 393), (416, 367),
    (413, 380), (416, 386), (413, 398), (415, 392), (416, 399), (415, 392), (421, 378), (432, 366),
    (420, 379), (422, 368), (428, 365), (400, 382), (412, 380), (429, 371), (449, 370), (423, 349),
    (390, 363), (421, 377), (402, 350), (390, 375), (396, 373), (393, 373), (421, 361), (409, 336),
    
    (575, 684), (551, 695), (558, 706), (554, 701), (588, 687), (587, 688), (584, 685), (635, 669),
    (547, 697), (547, 708), (571, 712), (596, 698), (580, 700), (623, 682), (610, 681), (661, 658),
    (521, 702), (545, 703), (547, 703), (554, 694), (589, 682), (588, 679), (642, 671), (617, 664),
    (507, 703), (516, 701), (518, 710), (530, 699), (541, 680), (546, 680), (552, 680), (561, 675),
    (491, 687), (482, 697), (496, 696), (510, 690), (518, 683), (503, 682), (525, 674), (517, 668),
    (484, 679), (489, 677), (498, 677), (502, 680), (515, 669), (517, 658), (555, 634), (527, 641),
    (480, 672), (491, 675), (514, 673), (513, 676), (520, 663), (528, 655), (547, 641), (501, 656),
    (505, 668), (510, 668), (525, 674), (536, 668), (543, 657), (534, 658), (538, 652), (497, 658),
    
    ( 958, 1275), ( 949, 1310), (1002, 1316), (1023, 1316), (1058, 1302), (1081, 1277), (1121, 1220), (1058, 1245),
    (1019, 1258), (1001, 1290), (1003, 1335), ( 998, 1349), (1005, 1381), (1075, 1315), (1057, 1300), (1131, 1257),
    (1035, 1252), (1024, 1274), (1026, 1311), (1042, 1321), (1054, 1332), (1121, 1309), (1134, 1258), (1131, 1263),
    (1010, 1264), (1016, 1280), (1019, 1289), (1021, 1310), (1024, 1332), (1045, 1318), (1050, 1317), (1073, 1276),
    (1029, 1226), (1015, 1272), (1015, 1271), (1028, 1289), (1030, 1285), (1024, 1290), (1042, 1270), (1055, 1263),
    (1024, 1217), (1036, 1216), (1027, 1247), (1028, 1241), (1031, 1248), (1043, 1236), (1057, 1221), (1054, 1220),
    (1027, 1214), (1033, 1202), (1052, 1174), (1054, 1188), (1050, 1197), (1059, 1181), (1067, 1147), (1086, 1124),
    (1017, 1200), (1014, 1203), (1029, 1195), (1055, 1160), (1040, 1189), (1016, 1195), (1035, 1187), (1015, 1199),

    ( 14,   0), ( 28,  10), ( 44,  30), ( 32,  57), ( 40,  48), ( 61,  63), ( 75,  69), ( 52,   0),
    ( 29,  37), ( 52,  84), ( 41,  92), ( 60,  88), ( 53, 108), ( 56, 117), ( 76, 116), ( 58,  77),
    ( 30,  60), ( 58, 102), ( 43,  11), ( 42, 123), ( 49, 131), ( 68, 135), ( 65, 131), ( 49,  86),
    ( 33,  50), ( 40,  92), ( 40, 114), ( 31, 122), ( 34, 125), ( 41, 125), ( 41, 114), ( 30,  75),
    ( 30,  31), ( 37,  70), ( 32,  96), ( 31, 112), ( 30, 111), ( 34, 100), ( 31,  84), ( 22,  54),
    ( 36,  28), ( 47,  61), ( 32,  74), ( 29,  89), ( 31,  91), ( 27,  80), ( 34,  69), ( 24,  49),
    ( 93,  38), ( 55,  55), ( 49,  62), ( 22,  68), ( 22,  75), ( 28,  73), ( 61,  65), ( 67,  48),
    ( 67,  16), (123,  28), ( 95,  45), (  8,  28), ( 51,  34), ( 13,  42), ( 88,  42), ( 76,  21),
];

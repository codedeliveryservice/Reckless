use crate::types::{Color, Piece, Square};

#[derive(Debug, Default, Clone, Copy)]
pub struct Evaluation {
    mg: i32,
    eg: i32,
}

impl Evaluation {
    /// Adds the score of a piece at a given square to the current scores using the PSQT.
    pub fn add_piece(&mut self, piece: Piece, color: Color, square: Square) {
        let (mg, eg) = get_bonus(piece, color, square);
        self.mg += mg;
        self.eg += eg;
    }

    /// Subtracts the score of a piece at a given square from the current scores using the PSQT.
    pub fn remove_piece(&mut self, piece: Piece, color: Color, square: Square) {
        let (mg, eg) = get_bonus(piece, color, square);
        self.mg -= mg;
        self.eg -= eg;
    }

    /// Returns the current evaluation scores for both middle game and end game phases.
    pub const fn score(self) -> (i32, i32) {
        (self.mg, self.eg)
    }
}

fn get_bonus(piece: Piece, color: Color, square: Square) -> (i32, i32) {
    match color {
        Color::White => {
            let index = piece as usize * 64 + (square.0 as usize ^ 56);
            PSQT[index]
        }
        Color::Black => {
            let index = piece as usize * 64 + square.0 as usize;
            (-PSQT[index].0, -PSQT[index].1)
        }
    }
}

#[rustfmt::skip]
const PSQT: [(i32, i32);  6 * 64] = [
    (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0),
    (129, 290), (160, 280), (134, 283), (159, 232), (146, 228), (130, 242), ( 61, 286), ( 35, 299),
    ( 58, 228), ( 75, 238), (104, 204), (107, 183), (112, 173), (133, 160), (118, 205), ( 74, 202),
    ( 48, 158), ( 73, 147), ( 72, 128), ( 77, 119), ( 96, 110), ( 86, 114), ( 94, 131), ( 70, 132),
    ( 40, 132), ( 67, 130), ( 69, 111), ( 83, 109), ( 86, 106), ( 80, 107), ( 82, 120), ( 60, 112),
    ( 42, 125), ( 63, 128), ( 66, 110), ( 72, 120), ( 86, 114), ( 77, 111), ( 98, 117), ( 70, 108),
    ( 45, 129), ( 67, 131), ( 61, 117), ( 66, 128), ( 76, 129), ( 91, 116), (110, 116), ( 63, 108),
    (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0), (  0,   0),
    
    (144, 265), (192, 317), (233, 339), (267, 330), (303, 332), (245, 308), (235, 317), (195, 242),
    (270, 317), (290, 339), (315, 346), (334, 345), (317, 338), (378, 323), (292, 333), (313, 301),
    (288, 333), (324, 348), (343, 364), (351, 365), (389, 350), (394, 344), (350, 337), (320, 322),
    (289, 343), (303, 364), (327, 376), (350, 376), (330, 378), (355, 374), (316, 362), (325, 334),
    (276, 345), (293, 354), (312, 376), (315, 376), (326, 379), (319, 369), (313, 355), (288, 335),
    (259, 328), (282, 347), (301, 354), (310, 369), (324, 366), (309, 349), (305, 342), (276, 330),
    (250, 319), (262, 335), (279, 345), (299, 345), (297, 346), (299, 340), (280, 326), (275, 329),
    (201, 312), (269, 310), (257, 327), (272, 331), (275, 333), (282, 323), (271, 317), (232, 300),
    
    (305, 338), (272, 345), (280, 340), (240, 353), (260, 345), (274, 335), (301, 331), (280, 336),
    (309, 326), (320, 328), (313, 329), (296, 330), (324, 321), (322, 321), (321, 331), (319, 325),
    (319, 348), (335, 332), (330, 330), (346, 319), (334, 324), (373, 326), (356, 328), (354, 341),
    (316, 341), (320, 339), (331, 329), (343, 339), (338, 332), (333, 333), (324, 334), (316, 341),
    (317, 335), (313, 337), (313, 337), (335, 333), (332, 333), (316, 332), (311, 335), (330, 326),
    (326, 338), (324, 335), (324, 333), (321, 332), (324, 335), (326, 331), (328, 327), (340, 329),
    (337, 338), (333, 326), (334, 317), (318, 332), (325, 330), (337, 322), (349, 332), (337, 323),
    (329, 331), (342, 336), (333, 329), (318, 334), (327, 333), (323, 341), (344, 321), (340, 319),
    
    (487, 554), (469, 563), (469, 572), (469, 567), (488, 559), (508, 552), (509, 550), (528, 545),
    (466, 557), (461, 570), (479, 573), (498, 563), (485, 563), (512, 550), (509, 546), (541, 531),
    (447, 558), (468, 560), (462, 562), (465, 559), (494, 546), (500, 540), (548, 531), (527, 526),
    (441, 560), (449, 557), (447, 565), (452, 561), (456, 547), (465, 542), (478, 539), (482, 535),
    (428, 552), (425, 555), (434, 556), (442, 554), (444, 550), (437, 548), (458, 538), (449, 535),
    (426, 548), (428, 546), (437, 545), (441, 547), (449, 541), (449, 533), (476, 517), (457, 520),
    (427, 543), (433, 544), (449, 543), (450, 544), (455, 537), (458, 531), (471, 524), (445, 531),
    (444, 543), (447, 544), (456, 548), (463, 544), (468, 537), (461, 540), (470, 531), (448, 531),
    
    (899, 967), (878, 989), (901, 1004), (931,  989), (933,  990), (947,  984), (981,  934), (934, 969),
    (906, 956), (879, 983), (882, 1014), (874, 1030), (880, 1047), (918, 1009), (908,  994), (959, 986),
    (908, 960), (899, 966), (893,  999), (903, 1005), (915, 1015), (959,  995), (970,  965), (972, 971),
    (892, 968), (892, 973), (891,  983), (890,  999), (890, 1013), (906, 1005), (914, 1002), (922, 996),
    (897, 959), (888, 979), (889,  976), (896,  989), (896,  987), (897,  985), (905,  983), (916, 981),
    (897, 950), (901, 955), (899,  964), (899,  960), (902,  964), (907,  964), (917,  954), (916, 954),
    (908, 943), (903, 941), (912,  934), (916,  937), (913,  943), (923,  918), (928,  898), (949, 880),
    (904, 939), (905, 935), (912,  931), (920,  946), (917,  929), (902,  935), (926,  911), (924, 909),

    ( 36, -49), ( 44,  -4), ( 66,   8), (  6,  40), ( 29,  28), ( 50,  35), ( 62,  34), ( 54, -53),
    (-11,  29), ( 20,  61), ( -9,  71), ( 69,  58), ( 35,  76), ( 37,  88), ( 57,  80), ( 40,  48),
    (-38,  47), ( 54,  68), ( -8,  86), (-22,  97), ( 13,  97), ( 76,  91), ( 56,  88), ( 22,  58),
    (-22,  39), (-32,  73), (-48,  92), (-90, 104), (-83, 105), (-47,  99), (-46,  90), (-73,  64),
    (-24,  28), (-30,  59), (-61,  83), (-90,  98), (-90,  98), (-51,  84), (-57,  72), (-83,  56),
    ( 15,  19), ( 32,  42), (-23,  63), (-37,  75), (-31,  75), (-28,  66), ( 15,  46), ( -3,  35),
    (101,  -2), ( 61,  25), ( 47,  37), ( 14,  48), ( 11,  51), ( 30,  42), ( 76,  23), ( 83,   5),
    ( 91, -37), (123, -19), ( 99,   1), (  6,  19), ( 67,  -2), ( 30,  16), (103, -11), ( 99, -41),
];

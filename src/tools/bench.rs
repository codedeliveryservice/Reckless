//! Bench is primarily used for testing the engine to verify that a change
//! does not introduce functional issues and that the engine's behavior
//! remains consistent. This is assuming that the change is not
//! triggered by very rare conditions or only activated at a higher depth
//! than specified.
//!
//! Note that although it can be used as a benchmarking tool,
//! it is not comprehensive enough to be definitive.

use std::{
    sync::atomic::{AtomicBool, AtomicU64},
    time::Instant,
};

use crate::{
    board::Board,
    search::{self, Report},
    thread::ThreadData,
    time::{Limits, TimeManager},
    transposition::TranspositionTable,
};

const POSITIONS: &[&str] = &[
    "2k5/2P3p1/3r1p2/7p/2RB2rP/3K2P1/5P2/8 w - - 1 48",
    "8/8/1k1NK3/r7/2R2P1P/3n2P1/8/8 b - - 0 59",
    "r1r3k1/1bqnbp1N/ppn1p1p1/4P1B1/8/2N5/PPB1QPPP/R3R1K1 w - - 3 9",
    "2kr1b1r/pp1qpp2/1np4p/3n1Pp1/3PN2B/2N2Q2/1PP3PP/2KRR3 w - g6 0 12",
    "r3k2r/Pppp1ppp/1b3nbN/nP6/BBP1P3/q4N2/Pp1P2PP/R2Q1RK1 w kq - 0 1",
    "6k1/8/pB2p1p1/3p3p/7q/PB6/Q7/2R3K1 w - - 0 37",
    "8/8/1p2k2P/1P6/P3B3/4B1K1/1b3P2/4n3 w - - 7 77",
    "7r/p1r1p2p/2k5/1p2n1N1/1Pp5/2R1P1P1/P4P1P/3R1K2 w - - 2 31",
    "r3k2r/p1ppqpb1/bn2pnp1/3PN3/1p2P3/2N2Q1p/PPPBBPPP/R3K2R w KQkq - 0 1",
    "5rk1/1p2r1p1/p4np1/P2p4/2pNbP2/2P1PB2/6PP/3RR1K1 w - - 2 23",
    "8/3k4/3b3p/R1p1p2P/p1Pr4/P2P1r2/2K1R3/4B3 b - - 4 75",
    "rn1qr1k1/1b3n1p/p5p1/1p3p2/2p1P3/2P2N1P/PPBNQPP1/R4RK1 w - - 2 9",
    "r7/1ppq1pkp/1b1p1p2/p4P2/1P2R3/P2Q1NP1/2P2P1P/6K1 w - - 0 13",
    "8/R3bpk1/4p3/3pPn1P/3P2K1/1rP4P/4N3/2B5 b - - 3 50",
    "2kn3r/ppp1b2p/4qp2/2P3p1/8/1Q3NPP/PP2PPK1/R1B5 w - - 0 10",
    "1r6/p1q2kpp/2p2b2/5p2/3p1P2/BP1P2P1/P1P2Q1P/4R1K1 b - - 10 20",
    "3r1bk1/p4pp1/Pq4bp/1B2p3/1P2N3/1N5P/5PP1/1QB3K1 w - - 1 29",
    "8/1R3pk1/3rpb1p/1P1p1p2/1P1P4/r4N1P/2R3PK/8 b - - 2 27",
    "6k1/8/1p2R3/1Pb1p1B1/8/1r5P/6K1/8 w - - 4 45",
    "r4rk1/1pp1qppp/pnnbp3/7b/3PP3/1PN1BNPP/P4PB1/R2Q1RK1 w - - 2 13",
    "8/p2r2pk/1p6/3p2pP/7N/P1R5/2p1r3/5R1K w - - 0 50",
    "1r3r1k/p1pbb1pp/1p1p1q2/4pP2/2P1P3/1P1P2P1/PB5P/R2Q1RK1 b - - 0 11",
    "1r1q2k1/3r2p1/p4p2/5p2/2p4Q/P3B3/1bP3PP/3R1RK1 w - - 0 19",
    "2k4r/1pp1b2p/p1n2p2/2P3p1/8/1P2BNPP/1P2PPK1/2R5 w - - 1 13",
    "8/1p6/3p1k2/Pp1Pp1bn/1P2P2p/3K3P/4NB2/8 w - - 9 38",
    "r2qk2r/1bpnppbp/3p2p1/3P4/PN2P3/4BP2/1P1QN1PP/R3K2R b KQkq - 0 6",
    "8/5k2/4p3/2Np4/3P4/3K1P2/7b/8 w - - 69 92",
    "2r1kb1r/pp2pp1p/2nN1n2/3p2B1/3P2b1/4PN2/q3BPPP/1R1QK2R b Kk - 1 4",
    "1r4k1/1q3bp1/6r1/pp1pPpB1/2p1nP2/P1P1QB1P/1P4RK/R7 w - - 1 38",
    "r4rk1/1pp1qppp/p1np1n2/2b1p1B1/2B1P1b1/P1NP1N2/1PP1QPPP/R4RK1 w - - 0 10",
    "r2q1rk1/1bpnbppp/1p2p3/8/p2PN3/2P2N2/PP1Q1PPP/1B1RR1K1 b - - 1 14",
    "r4rk1/2qbbppp/p1n1p3/8/2p2P2/P1N1BNQ1/1PP3PP/3R1RK1 b - - 5 11",
    "r4rk1/1bq1ppbp/6p1/2p5/P3P3/4BP2/1P1QN1PP/R2R2K1 w - - 2 11",
    "8/5pk1/4pr2/8/3Q1P2/7K/8/8 b - - 76 136",
    "8/2p5/3p4/KP5r/1R3p1k/8/4P1P1/8 w - - 0 1",
    "8/1k4p1/p4p1p/n1B5/2P3P1/7P/4KP2/8 w - - 0 41",
    "8/2q2p1k/1p2p1p1/4P1P1/p7/P4Q2/1p3PK1/1R6 b - - 3 38",
    "2r5/1pqn1pbk/p2p1np1/P2Pp1Bp/NPr1P3/6PP/3Q1PB1/1RR3K1 b - - 6 12",
    "6k1/5pbp/R5p1/Pp6/8/1r2P2P/6B1/6K1 w - - 0 31",
    "1r2qrk1/2p1bpp1/3p4/1pP2b1p/1P2N1nP/4P1P1/1BQ2PB1/3R2KR w - - 3 22",
    "2q1r1k1/1p2npbp/p5p1/8/8/2P2N1P/P2B1PP1/2QR2K1 w - - 2 17",
    "rnbq1k1r/pp1Pbppp/2p5/8/2B5/8/PPP1NnPP/RNBQK2R w KQ - 1 8",
    "8/8/1k1r2p1/p1p2nPp/P3RN1P/8/4KP2/8 b - - 13 55",
    "5r1k/1p3p1p/2p2p2/1q2bP1Q/3p1P2/1PP1R1P1/6KP/2N5 w - - 0 25",
    "8/8/5pk1/5Nn1/R3r1P1/8/6K1/8 w - - 4 65",
    "r2qkr2/p1pp1ppp/1pn1pn2/2P5/3Pb3/2N1P3/PP3PPP/R1B1KB1R b KQq -",
    "r4rk1/3bppb1/p3q1p1/1p1p3p/2pPn3/P1P1PN1P/1PB1QPPB/1R3RK1 b - -",
    "4Q3/8/8/8/6k1/4K2p/3N4/5q2 b - -",
    "r4rk1/1Qpbq1bp/p1n2np1/3p1p2/3P1P2/P1NBPN1P/1P1B2P1/R4RK1 b - -",
    "r1bqk2r/2p2ppp/2p5/p3pn2/1bB5/2NP2P1/PPP1NP1P/R1B1K2R w KQkq -",
    "8/8/4kp2/8/5K2/6p1/6P1/8 b - -",
    "r4rk1/3p2pp/p7/1pq2p2/2n2P2/P2Q3P/2P1NRP1/R5K1 w - -",
    "2rqk1n1/p6p/1p1pp3/8/4P3/P1b5/R2N1PPP/3QR1K1 w - -",
    "1r4k1/2qb1pb1/2p2P1p/8/p7/N1BB3P/P5P1/2Q2R1K b - -",
    "R7/1r6/5p2/8/P4k2/8/1p6/4K3 w - -",
    "r3k2r/1p1nqp2/p2p2pp/2pP4/6QN/2N5/PPP2PPP/R1B3K1 w kq -",
    "6KN/8/8/q7/5k2/8/8/8 w - -",
    "4r1k1/p2P1ppp/P7/R3Pp2/5b2/3K1q2/1r3P2/3R4 w - -",
    "8/1k6/1P6/3R3p/6p1/6r1/8/4K3 w - -",
    "2rq1rk1/5pbp/p3p1p1/1p1PPn2/5P2/P1NQ2P1/1B5P/R4RK1 b - -",
    "4rrk1/1pp4p/p2pb1pq/8/2Pn4/2NB3P/PP3PP1/1R2R1K1 b - -",
    "2kr4/Qp3p1p/6p1/2PnB1q1/3N4/P7/5PPP/4R1K1 b - -",
    "1k2q2r/p1p1bpp1/1pn1p2p/4P2B/2P1b3/4BN2/PP2QPPP/3R2K1 b - -",
    "b7/2p2ppk/1p2p2p/p3P2P/P3pK2/1P2P3/1bP1BPP1/3R4 b - -",
    "r1b1kb1r/pp4pp/2n1pn2/8/3N1B2/5N2/Pq2PPPP/R2QKB1R w KQkq -",
    "8/7P/5k2/p1K5/P7/1P5r/8/8 w - -",
    "r1b1k2r/pp1p1p1p/2n2np1/2q5/2PP4/8/PBP1BPPP/1R1QK2R b Kkq -",
    "r2q1rk1/1pnbbpp1/p1np3p/P1p1p3/4P3/1P1P1NP1/2PB1PBP/R2Q1RK1 w - -",
    "2r3k1/r4ppp/1q1bb3/8/3p3P/1P3B2/P2BQPP1/RR4K1 b - -",
    "8/8/4k1p1/2r5/2P1R1KP/4P3/5P2/8 b - -",
    "3rk2r/pb2ppb1/1pp2npp/8/2P4B/2N3P1/PP2PPBP/2R2RK1 b k -",
    "8/8/3k4/8/8/3KP3/2Q5/8 w - -",
    "r1b1kb1r/pp2pppp/1q3n2/3p4/PP6/2P2N2/3NPPPP/R2QKB1R b KQkq -",
    "r1b2rk1/1p2b1pp/p2qp3/P3np2/8/2PP2N1/5PPP/RBBQR1K1 b - -",
    "2bb1rk1/1p4p1/2p1p2p/8/Q3P3/P4N2/1P2NPPP/6K1 b - -",
    "4r1k1/7p/pp2N3/2pR1p2/P1p5/2P4P/1P4P1/6K1 w - -",
    "4n1k1/2p2pp1/2P4p/8/1N1p1P1P/Pp4P1/1P3P2/6K1 w - -",
    "8/3N2k1/1p2p2p/8/2pP1p2/r6P/3r1P2/5RK1 w - -",
    "3rr1k1/1pp1bpp1/4q2p/nP1pP3/7P/1QPR1NB1/5PP1/3R2K1 w - -",
    "r4rk1/ppqn2pp/2pb1n2/3pp3/8/3P2P1/PPPN1PBP/R1BQK2R w KQ -",
    "r1bqkb1r/1p2nppp/p1n5/2ppP3/8/2PB1N2/PP1P1PPP/R1BQ1RK1 b kq -",
    "8/1n4k1/8/3K4/1P6/3N4/8/8 w - -",
    "2r2b2/2q3k1/2n1bppp/pB1p4/N2P4/4P3/PR3PP1/1Q3RK1 b - -",
    "r1b2rk1/pp2bppp/8/1N1Pp3/2p1P3/PnN1q3/RPQ1B1PP/5RK1 w - -",
    "8/1p6/2b5/2b5/2P5/8/2K2k2/8 b - -",
    "r4rk1/5p1p/4p1p1/p1p1B1b1/PpQ5/1P1P4/2P2PKP/R3R3 b - -",
    "3rkb1r/2p2ppp/p4n2/1p2p3/2BnPP2/P1N1B3/1PP2P1P/R1K4R w k -",
    "r3kb1r/1pp1nppp/2n5/1p2P3/4N1b1/4B1P1/PPP2P1P/R3K1NR w kq -",
    "r4rk1/pbpqbppn/1pn1p3/3p4/P1PP1B2/4PN2/1P1N1PPP/R2Q1RK1 b - -",
    "8/1p4k1/8/1n2P3/5P2/p2K4/5r2/R7 w - -",
    "r4rk1/1pp3pp/8/p1nPR2Q/P7/1P5P/2P2qP1/3R2K1 w - -",
    "r1bqk2r/pp1n1pp1/3bpn2/3p3p/3P3P/5NP1/PP1NPPB1/R1BQK2R b KQkq -",
    "8/5kp1/1K5p/8/6P1/8/8/8 b - -",
    "2r5/1p1kb1p1/4pP2/pP1p2p1/1n1P4/1N2B3/1P3PPP/5RK1 b - -",
    "r4rk1/pp2qp1p/2np1p2/3p2N1/3P4/2P1P1P1/PP4BP/RN1b1RK1 w - -",
    "8/8/4K3/8/8/8/6k1/8 w - -",
    "8/8/4p1k1/2p3p1/8/8/1q6/4K3 b - -",
    "8/5Q2/8/5K2/3p1P1Q/p7/2k5/8 w - -",
    "r3r1k1/2p1np2/pp1p3p/6p1/3PN3/2PBP2P/P5P1/1R1Q2K1 w - -",
    "8/k7/5K2/8/5Q2/8/8/8 b - -",
    "r5r1/2p2pk1/1pb4p/p3R3/P1P1p3/1P4P1/2PN2KP/R7 b - -",
    "r2q1rk1/1p2bppp/p2pbn2/8/1n2P3/1NNP4/1B2BPPP/R2Q1RK1 w - -",
    "8/8/4p3/2p3P1/2P1k1P1/8/3K4/8 b - -",
    "r1b1k1nr/pp3ppp/2pqp3/3n4/3P4/5N2/PPP1QPPP/R3KB1R w KQkq -",
    "8/2R2B2/6k1/4r3/7K/2pb4/8/8 b - -",
    "r5k1/1ppb3p/p2P2P1/3p1p2/8/1QPB3P/PP1b2P1/R5K1 b - -",
    "8/6K1/8/8/8/3k4/8/8 w - -",
    "8/p7/1p2k3/2p5/b1P1BP1B/3K4/1b6/8 w - -",
    "8/8/5b2/1P1k4/8/4R3/K7/7q w - -",
    "8/8/6k1/7p/5K1P/5PP1/8/5R2 w - -",
    "r1bq1rk1/pp1nbpp1/7p/2p1p3/P3P3/2N5/1PPBBPPP/R2Q1RK1 w - -",
    "3R4/6p1/4p1P1/n1p1P1k1/8/4K1p1/8/8 w - -",
    "r5k1/pB1b1ppp/3qpb2/8/3n1N2/6P1/4PP1P/2BQ1RK1 b - -",
    "5r2/6k1/8/6p1/1p2pb1P/1P5b/2P1BK2/6R1 w - -",
    "8/4k3/5b1p/6pP/8/1Bp2P2/4K3/8 b - -",
    "r1bq1rk1/pp1n2p1/3bpn1p/3p1p2/3P4/1N1Q1NP1/PP2PP1P/R1B2RKB b - -",
    "8/2R5/8/4PKPk/8/5r2/8/8 w - -",
    "2r3k1/pp2p1b1/8/3q3P/3p3p/3P3P/PP1N1r1K/R2QR3 w - -",
    "rn1qk2r/ppp1bppp/8/3pP3/3P4/2N2N2/PPQP2PP/R1B1K2R b KQkq -",
    "4Q3/8/p2k4/7P/5RP1/2K5/P7/8 b - -",
    "r4r2/q4pkp/p2b4/3p4/P4P2/3QP2P/P5P1/3R1RK1 w - -",
    "k7/8/5P1K/8/8/8/5q2/7q w - -",
    "2r3k1/pp3p1p/2B1b1p1/2n1p3/8/2N4P/PPP2PP1/2KR4 w - -",
    "R7/5k2/3p1p2/2p1pbpP/8/2K1PP2/8/8 w - -",
    "3r4/7k/7p/2B3p1/8/5nPP/8/2R4K w - -",
    "rq2r1k1/pbp4p/1p4p1/3n1p2/PPQPnP2/5N2/1B3PBP/R4RK1 b - -",
    "r1bqk3/ppp2ppr/5p2/8/1P1N4/8/PP3PPP/R1BQK2R b KQq -",
    "8/8/p5pk/2R5/1nP2p1P/4r3/4BK2/8 w - -",
    "8/2R5/7k/4r3/5RPP/3K4/8/8 b - -",
    "1q5r/4k2p/2pbbpr1/3ppp1Q/8/P1P1PP1P/4B1P1/1NKR2R1 b - -",
    "r2q1rk1/p1p2p2/2p2bp1/4p2p/N3P3/2P2QPP/PP3P2/R3K2R w KQ -",
    "2kr2r1/p1p1bp2/2p1b2p/6P1/P3Q3/2PP3P/q2B1P2/2KR1BR1 w - -",
    "8/5R1k/3P3p/8/2P4P/1p6/r7/4K3 b - -",
    "4nr2/6pp/pkp3b1/2p5/8/2P2N1P/PP1N1PP1/R5K1 w - -",
    "8/5Nk1/8/p4p1P/5K2/1P6/P7/8 w - -",
    "r1bqk2r/ppp1bp1p/2np1n2/6N1/2P3p1/6P1/PP1PPPBP/R1BQK1NR b KQkq -",
    "r4rk1/pp1bqppp/2pb1n2/3p4/2PPp3/PPN1P3/1B2BPPP/R2Q1RK1 w - -",
    "r2qk2r/pb1pbppp/1pn1p3/1Np5/2P5/1P3N1P/PB1PBRP1/R2Q2K1 b kq -",
    "r2q1rk1/p1p1bppp/4p3/2np4/5Pb1/4PN1P/PP1QB1P1/RN3RK1 b - -",
    "3r2k1/pp4p1/6qp/8/P1b5/5P1P/4NP1K/4R2R w - -",
    "r2qkb1Q/p4p1p/2p3p1/3p4/6b1/2P2NP1/P1P2PBP/R3K2R b KQq -",
    "rnbq1rk1/p3bppp/5n2/2pp4/8/2N1PN2/PP2BPPP/R1BQ1RK1 w - -",
    "1r3rk1/3bqpp1/1ppp3p/p7/P1PPPnP1/4NB2/2QB1PP1/1R3RK1 b - -",
    "8/1p4k1/p7/b7/4P1Bp/5K2/2P5/8 w - -",
    "r1bqk2r/pppp1ppp/5n2/4n3/2PP4/P5P1/5P1P/R1BQKBNR b KQkq -",
    "8/8/5k2/8/5P2/1K6/8/3R4 w - -",
    "r4rk1/pBp3bp/4bnp1/4pp2/2P5/P1N3P1/1P2PP1P/R1BR2K1 b - -",
    "r2q1rk1/pp1bbp2/3p1n1p/2pP4/2P5/6P1/PP2PPBP/R2QK1NR w KQ -",
    "rnbqk1nr/ppp2pbp/6p1/3pPp2/3P4/5N2/PPP3PP/RN1QKB1R w KQkq -",
    "5r1k/2pbq1pp/8/2p2p2/P2P4/2P2R2/Q5PP/6K1 w - -",
    "r3kb1r/1p1n1ppp/p2p4/2pPp3/4n1Bq/2P5/PP3PPP/RNBQ1RK1 w kq -",
    "r1bq1rk1/pp2b1pp/2n1pp2/2p5/2P3n1/PPN2NP1/4PPBP/R1BQ1RK1 b - -",
    "6k1/1p4pp/p7/3r1p2/8/1P4P1/P6P/3K1B2 w - -",
    "r1b1kbnr/1p2nppp/pq2p3/3P4/3p1P2/2N2N2/PPP1B1PP/R1BQK2R w KQkq -",
    "r2qkb1r/pp3ppp/2n1n3/2p5/4N3/3P4/PP3PPP/2RQKB1R w Kkq -",
    "8/8/3b4/p6B/7P/4P1P1/1Bbk1K2/8 b - -",
    "r1bq1rk1/pp2ppb1/3p1np1/6N1/2Pn4/2N4P/PP2BPP1/R3QRK1 w - -",
    "5r2/8/1pR5/8/1p6/1r2k1P1/3R2K1/8 w - -",
    "6RQ/6P1/p7/6K1/4k3/5r2/8/8 b - -",
    "r1bq1rk1/pp1n2bp/2p3p1/4pp2/2P5/P1P1BNP1/4PPBP/R2Q1RK1 b - -",
    "5k2/8/3p4/1P1P1p2/B2p1K1P/3P4/8/8 b - -",
    "6k1/p2pqpp1/5n1p/1Qp5/8/n5P1/P3PP1P/5RK1 w - -",
    "8/pp6/6k1/4Rp2/P7/1P2K3/2P2P2/3r4 w - -",
    "r1bqk2r/1p1n1pbp/p2p2p1/2pP3n/4P3/P1N2N1P/1PP2PP1/R2QKB1R w KQkq -",
    "r1bq1rk1/1p1nbppp/p1n1p3/2ppP3/3P4/P1P2N1P/1P1NBPP1/R1BQ1RK1 w - -",
    "r3kb1r/pp1npppp/8/3p1b2/3P1B2/4P2P/PP1K1PP1/2R2BNR w kq -",
    "8/P4k2/2R5/5K2/8/3r4/1p6/8 b - -",
    "r2q1rk1/p4pb1/npp2ppp/3p4/3P2b1/4QNP1/PPPNPPBP/R4RK1 w - -",
    "r1b4r/ppp1kpp1/5n1p/8/1n1P4/2NB4/PP2KPPP/3R2NR w - -",
    "8/5p2/3b1k2/8/4P1p1/8/8/1K6 b - -",
    "8/5pk1/2P2bpp/r3p3/4P3/1P3PP1/4BK1P/3R4 b - -",
    "r2qkb1r/pQ1npppb/5n1p/3p4/3P1BP1/2N1PN1P/PP2BP2/R3K2R b KQkq -",
    "8/8/2k4P/4NK2/2r5/5P2/p7/8 b - -",
    "7k/8/6Q1/3K2P1/7q/8/8/8 w - -",
    "8/8/6KP/3R4/8/1k6/8/8 b - -",
    "rn2k2r/2p1bppp/2b5/pp2p3/P5n1/2N2N2/1PP1PPBP/R1BR2K1 b kq -",
    "r1bqk2r/pppn1pp1/7p/3P4/1b1P4/5NP1/PP1N1PP1/R2QKB1R b KQkq -",
    "8/8/6R1/7P/3k4/6K1/8/r7 w - -",
    "8/8/1K6/8/R7/8/1k1n4/8 w - -",
    "4r1k1/ppp2p2/6p1/3R3p/5P2/8/PPP3PP/5RK1 w - -",
    "8/7K/8/5Q2/5P2/k7/8/8 w - -",
    "2r4k/1B5p/p3p3/P4p1P/7q/2r5/5PP1/3RR1K1 b - -",
    "8/5pk1/8/3b4/p6P/1p6/1Br1RKP1/8 b - -",
    "r2qk2r/p1p2pb1/2np1npp/1P2p3/4P3/2NP1BPP/PP3P2/R1BQK2R b KQkq -",
    "3rb1k1/p6p/6p1/2pP1p2/2B2p2/P6P/5PP1/1R4K1 b - -",
    "5rk1/pb4p1/2n4p/1NQ5/4p3/2P1P1qP/PP4B1/3R2K1 b - -",
    "2Q5/8/4p3/1p1pk3/7R/5K2/3r4/8 b - -",
    "8/p6k/1p1p4/2pB1p2/2Pn4/3P2Q1/PP6/7K b - -",
    "rnbq1rk1/pp4pp/2pb1n2/3p1p2/P2P4/6P1/1P1BPPBP/RN1QNRK1 b - -",
    "2r2rk1/ppN1nppp/5q2/8/3p4/3B4/PPPQ1PPP/3R2K1 w - -",
    "8/5R2/5K2/8/4r3/5k2/8/8 w - -",
    "rnb1k2r/2p1bppp/1p2pn2/pP6/3NP3/P1NB4/5PPP/R1BQK2R b KQkq -",
    "r1b3k1/4b3/p6p/n7/p3Np2/3B1N1P/1q2QPP1/R4RK1 b - -",
    "8/8/k7/b6Q/8/1K6/1Q6/8 w - -",
    "3q1rk1/p4p2/1p2b1pp/4Q3/4B3/P5P1/1P3P1P/2R3K1 b - -",
    "2r2rk1/pp2pp1p/3q2p1/3p1b2/3R4/1PB3PP/P3PPB1/4QRK1 b - -",
    "8/8/6k1/5R2/6r1/8/5K2/8 w - -",
    "rn1qkb1r/pp2pp1p/6p1/1b2P3/8/2Q5/PP3PPP/R1B1K1NR w KQkq -",
    "rnbqk2r/1p2bpp1/p3pn1p/2PpN3/3P1B2/3BP3/P1P2PPP/RN1Q1RK1 w kq -",
    "rnbqk2r/1pp2ppp/4pn2/pPB5/2P5/P4N2/3PPPPP/RN1QKB1R b KQkq -",
    "r1br2k1/pp2bppp/2nR4/4p3/1PN1P3/2P2N2/P1n2PPP/4KB1R w K -",
    "r2r4/pp2N1kp/5pp1/2P5/PP1b4/3R4/2P3PP/1R4K1 w - -",
    "r2qkbnr/pp3pp1/6b1/3pB3/6p1/1P1P3P/P2NPP2/R2QKB1R w KQkq -",
    "rn3rk1/pb5p/4q1pQ/1Bpp4/4pP2/1P2P3/P2N2PP/R4RK1 b - f3",
    "r2qk2r/pp1nbppp/5n2/4p3/8/4BP1P/PPP2PP1/R2QKB1R w KQkq -",
    "4b1k1/8/6pp/8/2Pq1PQ1/1P5P/6K1/8 w - -",
    "8/8/1p1p1k2/3P4/2P5/8/2K5/8 b - -",
    "8/1p4p1/4k2p/2p4P/P1P2PP1/3K4/8/8 b - -",
    "8/7B/1p1k1p2/3p3p/7P/1Pb2K2/5P2/8 b - -",
    "8/1pbr2p1/2p2pkp/8/1P1Bb3/4P1PP/4BP2/2R3K1 b - -",
    "rkr5/1b3ppQ/pb2p3/4q3/3N4/1PP2PP1/PB1P2KP/5R2 b - -",
    "8/6R1/2b3K1/8/7k/8/8/4r3 w - -",
    "6k1/8/8/8/3b1q2/5P2/8/6K1 w - -",
    "r2qkbnr/pp2pppp/2n5/2p5/2B2Pb1/2N2pP1/PPPP3P/R1BQK2R w KQkq -",
    "rnbq1rk1/1pp1n1b1/1p1p2pp/3Np3/2P1Pp2/3P1N2/PP2BPPP/R2QK2R w KQ -",
    "r2qk1nr/pp1n2pp/5p2/2bp4/5B2/4P3/PPP2PPP/RN2K1NR w KQkq -",
    "r1bq1rk1/ppp2pB1/2np2pp/8/2P3P1/1P1Bn2P/P4P2/R2QK1NR w KQ -",
    "8/5k2/1R6/5K2/8/8/8/6r1 b - -",
    "5r1k/1pp3p1/p2p4/8/3N4/8/bPP3PP/6K1 w - -",
    "r1bq1rk1/pp2bppn/4p3/2np4/5B2/2P1PN2/PPQ2PPP/RN3RK1 w - -",
    "8/8/8/7P/8/1k6/7B/5QK1 b - -",
    "6R1/6K1/2k5/8/8/8/8/8 w - -",
    "8/8/P7/1r3p1p/2kbK2P/4P1P1/5P2/8 w - -",
    "3r1bk1/1pp2pp1/q1b1p2p/p2nP3/3P4/PQ3NPP/3B1PB1/2R2RK1 w - -",
    "2r3k1/1p4bR/2p1p1p1/Pp3rP1/3PpP2/2B4R/5K2/8 w - -",
    "5k2/8/1pB5/6KP/P7/8/8/8 b - -",
    "8/8/6p1/8/3Kbk2/1p6/7p/1r6 w - -",
    "r4rk1/pp1b2pp/1b1B4/3P4/4Pp2/1P3R2/1P2p1PP/2R4K b - -",
    "r3kbnr/ppp2ppp/2n5/3p1B2/8/P1P2P2/4KPPP/RNB4R b kq -",
    "2rr2k1/p4pb1/1p4p1/3b3p/P6P/2P2P2/3B1P2/1R2K2R w K -",
    "r3kb1r/pb3ppp/2n1pq2/2p5/Q7/2P2N2/PP3PPP/R1B1KB1R w KQkq -",
    "8/5R2/3Q4/2P4p/4k1r1/8/1P3P1K/8 b - -",
    "r1bq1rk1/1pp1bpp1/p4p1p/3p4/P2P3P/5NP1/2P1PPB1/RNQ2RK1 b - -",
    "3r1rk1/1pp1bp2/2n4p/4p1pq/Q7/2NPB1P1/PP2PP1P/R4RK1 w - -",
    "5k2/8/p3p3/R6p/5PpP/4K3/8/8 b - -",
    "6k1/2rq4/2p3pp/1p1p1p2/p1nP1P2/P2N2P1/1P1nR1BP/2R3K1 b - -",
    "r2qk2r/pb2bpp1/1pnppn1p/2p5/2PP1B2/P1N2NP1/1P2PP1P/R2QKR1B b Qkq -",
    "2k4r/p1p5/1pP2pp1/4pn1p/1B4nP/2P2N2/P1P1QPP1/1K1R4 w - -",
    "r1bq1rk1/ppp2pp1/2n1pn1p/1NP5/3P4/1P6/P3B1PN/R1BQ1RK1 b - -",
    "7r/Bppn1pbp/5p2/3k2p1/8/8/PP1N1PPP/4R1K1 b - -",
    "r2qkb1r/pbpp1ppp/1p2pn2/8/1n5P/1P3NP1/PBPPPPB1/RN1QK2R b KQkq -",
    "1r1k1r2/p3ppb1/2p2npp/8/P1B5/2N5/1Pb2PPP/R1B1R1K1 w - -",
    "r5k1/5p2/2p3pp/q2p4/8/6P1/3Q1P1P/4R1K1 w - -",
    "2bqkb1r/1ppp1ppp/4pn2/4N3/1r6/2N1P3/PBPPBPPP/1R1QK2R b Kk -",
    "3r4/5kpp/2p5/6R1/n1P1K3/8/P1P2P1P/8 b - -",
    "8/8/2K5/8/4k3/1q6/r7/8 b - -",
    "8/3k4/8/6R1/5p1p/1n1K1B1P/6P1/8 b - -",
    "8/8/8/8/7p/4k1n1/8/2K5 b - -",
    "rn1q1rk1/pbp1bppp/1p2p3/3p4/1P1P4/2P1PN2/P3BPPP/R2Q1NK1 b - -",
    "2rq1rk1/1b2p3/1p3p1p/p2p4/3P4/4P1PP/PP2P1BK/R2Q1R2 w - -",
    "5R2/8/p7/2K3k1/1P6/8/8/7r w - -",
    "rnb1r1k1/pp3ppp/2p2N2/2bqp3/8/6P1/PPPPQPBP/R1B1K1NR b KQ -",
    "8/8/3r3k/6p1/4pp2/1p6/5P2/Q4K2 w - -",
    "rn2k2r/1p3ppp/2pqpn2/p2p4/3P4/1P2PN2/PB2BPPP/1R1Q1RK1 w kq -",
    "rnbq1rk1/1p2ppbp/p2p1np1/3P4/1PP5/2N2N2/PB3PPP/R2QKB1R b KQ -",
    "rn4k1/p3p3/2p1p1pp/7B/8/8/NPP2PPP/4RbK1 b - -",
    "8/8/8/7K/3b1kP1/8/8/1B6 b - -",
    "8/1p3kB1/p7/P7/1b2R1p1/1K2P1P1/5P2/8 b - -",
    "6k1/5p1p/N5p1/8/8/b3rP1P/6P1/3R2K1 w - -",
    "r4rk1/1b3p1p/1p1p2p1/pPnPp1Nn/4P3/1P4PP/P1B2P2/R4RK1 b - -",
    "rn1k1b1r/pb3p1p/1p1p4/2pP1p2/2P5/8/PP3PPP/RQ2KB1R b KQ -",
    "r1bq1rk1/ppp2p1p/6p1/4n3/4N3/8/PPP1QPPP/R1B2RK1 w - -",
    "5rk1/p1q1b2p/1p4p1/4np2/8/1P2P3/PB2QPPP/1R3RK1 w - -",
    "r2qrnk1/1p3pp1/2p2n1p/p7/2b4N/2N1P1P1/P1QB1PBP/1R3RK1 w - -",
    "5Q2/8/4K3/8/2k1P3/5R2/8/8 w - -",
    "3q1rk1/1b2bppp/pp2p3/6N1/P2P4/1P6/5PPP/2nR2K1 w - -",
    "4k3/8/8/6P1/3B1P2/2K5/7P/8 b - -",
    "r4rk1/1q3p2/3P1b2/5p2/4p3/4P3/1BP2P2/1K1R1Q1R w - -",
    "6r1/8/8/8/1R6/1K6/8/4k3 w - -",
    "Q1Q1Q3/8/1K3p2/7p/7p/6k1/8/8 b - -",
    "3r2k1/p5p1/1p3p1p/4pP2/Pb1pP3/3K2P1/1PP1N2P/R7 b - -",
    "rnbqk2r/ppp1bp1p/3p1np1/8/3NPB2/2N4P/PPP2P2/R2QKB1R w KQkq -",
    "1R6/8/8/k7/8/4K3/2r5/8 w - -",
    "r3r2k/1pnb2b1/2p2qPn/p2p1p2/3P1Np1/3BP3/PPQB1PP1/2R2RK1 b - -",
    "1rb2rk1/q2nppbp/p2p2p1/3P4/4PP2/2NPN3/1P2B1PP/R1B2RK1 b - -",
    "r4rk1/pp1bppbp/n1p2np1/3P4/5P2/3Pq1PP/PP1N2B1/R1BQ1RK1 w - -",
    "1k2r3/pqp2p1p/1p1p1Q2/r4P2/4b3/P1N2B2/1PP3PP/4RRK1 b - -",
    "2b2rk1/4pp1p/3q2p1/p2p4/Pp1Q4/1P2PNP1/5PBP/R5K1 w - -",
    "1r4k1/8/6N1/pb6/4P2p/P2pKP2/1P4P1/2R5 b - -",
    "3r2k1/2p1nppp/1p4b1/8/p1B5/1PP1P3/1P4PP/4R1K1 b - -",
    "2b3k1/1r3r2/p2B4/3P1ppp/1b6/1B2P3/5PPP/R5K1 w - -",
    "5k2/5p2/6bR/pP6/P2p4/5r2/3K4/8 w - -",
    "r2q1rk1/p1pp1ppp/1pn1p3/4P3/2BP4/P1P2P2/P4P1P/R1BQ1RK1 b - -",
    "2r2r2/3qbp1k/2p2p1p/p2p4/8/PP2PN1P/3N1PP1/Q2R2K1 w - -",
    "5rk1/pb1q1p2/1p2p2p/1P4p1/3b4/4Q1PP/PP2PPB1/2R3K1 w - -",
    "rnbq1rk1/p1pn1ppp/p7/4p3/1b1PP3/5N2/1P3PPP/RNBQKB1R w KQ -",
    "r2r2k1/1bp2pbp/6p1/1BpPp1q1/2P1PnN1/P1N4P/1P3PP1/3RR1K1 b - -",
    "8/6Q1/5P2/3p4/4k1Pp/7K/8/4q3 w - -",
    "4b1k1/8/1K4p1/2Q3P1/8/8/r7/8 b - -",
    "7r/1pkb2p1/1pn1pp2/1B1p4/Pb2n2p/4PN1P/1PP1KPP1/R2R4 b - -",
    "8/8/6p1/5p1p/1k5P/4PP2/5KP1/8 w - -",
    "8/7k/p2p3p/5p2/8/2B3P1/q6K/4Q3 w - -",
    "1r6/2b3k1/2p1bp1q/p1p1p3/Pr1pP1p1/1P1P2P1/QNPN1P2/3R1RK1 b - -",
    "r1bqnrk1/1p2bppp/p3p3/2p1P3/5P2/1P6/PBPPB1PP/RN1Q1RK1 w - -",
    "r6k/5p1p/3B2p1/p7/4P3/4bPP1/PPP3BP/1R3b1K b - -",
    "8/8/2KB4/8/p7/P1pb4/8/3k4 w - -",
    "rnbqk2r/ppp2pbp/4p1p1/3P4/3P1B2/4P3/PP2BPPP/R1Q1K2R b KQkq -",
    "r4rk1/1qp1b1pp/2p1pn2/p1P2p2/1P1P1P2/1PB1PP2/3QN2P/R4RK1 b - -",
    "2n2rk1/5ppp/4p3/4P3/8/P2Q2P1/1P5P/1KR4R w - -",
    "r3kr2/pp2ppbp/5np1/2p5/2P3P1/2N1P2P/PPn1BP2/R1B2RK1 w - -",
    "8/5p2/3Qb1k1/1P5p/7P/3N4/2q2P2/7K b - -",
    "8/8/8/8/Q7/K3k3/2q5/8 b - -",
    "3r1rk1/1Bpn2b1/p3q2p/4pp2/3n3P/3PB1P1/PPP2Q2/R2N1RK1 w - -",
    "5k2/1p6/8/4p1RN/2P4P/3P1KP1/1r6/q7 b - -",
    "8/8/4k1p1/7p/7P/3K4/8/2R5 b - -",
    "8/8/8/4K3/8/7r/6k1/8 w - -",
    "rn2k2r/pp2ppbp/6p1/5b2/q2PpB2/4PN2/PP3PPP/RN3K1R w kq -",
    "5bk1/1p2pp2/p5pp/P2n4/1P1Pp2P/1Q4P1/1B2PP2/5K2 b - -",
    "8/3k4/7R/1R4P1/1P6/P3n2P/2r5/4K3 b - -",
    "r2qk2r/pb1p2pp/1pnP4/6p1/3p1n2/5N2/PPP1BPPP/R2Q1RK1 w kq -",
    "r2r2k1/BQp1bpp1/5n1p/8/8/2Pq2P1/PP3P1P/R4RK1 b - -",
    "r2B1rk1/pppb1pbp/n2p2p1/4p3/1PP1P3/2n2N2/P4PPP/R2QKB1R w KQ -",
    "1n1q1rk1/Q2bpp1p/6p1/8/8/2b3P1/P3PPKP/R1B2R2 w - -",
    "3r2k1/pp1r2bp/5pp1/2P1p2n/1PP4Q/R4P2/P4P1P/2B1R1K1 b - -",
    "8/4kpp1/7p/7K/4Q2P/4P3/5rP1/8 b - -",
    "r1bqk2r/3pnppp/p7/1pbP4/8/2NQ1N2/PP3PPP/R1B1KB1R w KQkq -",
    "rnb1kb1r/pp2pp2/2q2n1p/3N2p1/3P4/P4NB1/1P2PPPP/2RQKB1R b Kkq -",
    "2r2rk1/pp3pbp/3p1pp1/2n5/1qbN4/2N1P3/PPBB1PPP/R2R2K1 w - -",
    "4k1R1/p7/5p2/2p5/P1P2P2/7K/1r5p/8 b - -",
    "6k1/p2r2p1/R6p/PP3p2/4p2P/6P1/2r2P2/4R1K1 b - -",
    "1k5r/pp1Pr1p1/n2b1pp1/4pn2/1PP1N3/P4NB1/2Q2PPP/R4RK1 w - -",
    "8/8/4R3/5K2/8/8/8/3q1k2 b - -",
    "8/5K2/2k4p/R7/2N5/5p2/PP6/8 w - -",
    "1r1qkbnr/1pp2ppp/p1n1p3/3p4/3N4/1P1PP2P/PB1P1PP1/RNQ1K2R b KQk -",
    "rnbq1k1r/4p1b1/1p4p1/pBpn3p/5P2/4P3/PP1P2PP/RNBQ1RK1 w - -",
    "8/8/p2r1k2/R5p1/1PR5/5K2/6P1/1r6 w - -",
    "4k3/p7/p3r3/R5PK/3B3P/2P5/8/2r5 w - -",
    "4r1k1/4q3/b4pp1/N3n2p/3B4/4P3/P1Q2PP1/2R1K3 b - -",
    "7r/1pk3p1/p4pB1/4p1p1/bPPr4/3P3P/5PP1/4R1K1 w - -",
    "r1b1k2r/pp2bppp/1q1p1n2/2p5/3pP3/2NP2PP/PPPB1PB1/R2QKR2 w Qkq -",
    "3qk2r/1p3pp1/4p2p/4nb2/2Pp4/3P3P/4BPP1/2B1NNK1 b k -",
    "8/7K/3R4/8/8/8/7k/8 b - -",
    "1r4k1/8/8/p2p3b/4pq2/P3R3/5PP1/5RK1 w - -",
    "2kr1b1r/1pp2ppp/p7/2P5/1P6/3b1NP1/PB1P3P/RNK5 b - -",
    "5r1k/1p2n3/p5pp/3PPp2/8/P2N2P1/1PR3BP/7K w - -",
    "4Q3/8/1k6/8/8/5R2/6P1/6K1 w - -",
    "4r1k1/1p3pp1/p2qp2p/3pn3/1PrQP3/2P2B2/P4PPP/3R1RK1 w - -",
    "5k2/2pb1ppR/3q4/N7/2Pp3Q/6P1/P4PPK/1r6 b - -",
    "8/8/8/R7/P6k/1K6/8/r6q b - -",
    "3rkb1r/1p2pppp/p1n3q1/2p2bB1/2P5/3P1N1P/PP3PP1/R1KQ1B1R w k -",
    "rq3rk1/1p3pb1/p1ppn1p1/PP2p3/2P1P3/3PN1P1/3Q2BP/1R3RK1 b - -",
    "rnbq1rk1/pp2ppbp/2p3p1/3p4/1B1Pn3/4PNPP/PPP2PB1/RN1Q1RK1 b - -",
    "r1b1k2r/pp1pbppp/4p3/4q3/8/P1P5/1B2BPPP/R2Q1RK1 w kq -",
    "1r2r1k1/1pqb1p2/2pp1p1p/p1n5/P1P1PNnP/1P4P1/2QN1P2/3RRBK1 w - -",
    "8/p5k1/6p1/1P2p1p1/3pq1P1/3N3P/4r3/6K1 w - -",
];

const DEFAULT_DEPTH: i32 = 12;

pub fn bench<const PRETTY: bool>(depth: Option<i32>) {
    if PRETTY {
        println!("{}", "-".repeat(50));
        println!("{:>15} {:>13} {:>15}", "Nodes", "Elapsed", "NPS");
        println!("{}", "-".repeat(50));
    }

    let depth = depth.unwrap_or(DEFAULT_DEPTH);

    let tt = TranspositionTable::default();
    let stop = AtomicBool::new(false);
    let nodes = AtomicU64::new(0);
    let tb_hits = AtomicU64::new(0);

    let mut td = ThreadData::new(&tt, &stop, &nodes, &tb_hits);

    let time = Instant::now();

    let mut nodes = 0;
    let mut index = 0;

    for position in POSITIONS {
        let now = Instant::now();

        td.board = Board::from_fen(position).unwrap();
        td.time_manager = TimeManager::new(Limits::Depth(depth), 0, 0);

        search::start(&mut td, Report::None);

        nodes += td.nodes.local();
        index += 1;

        let seconds = now.elapsed().as_secs_f64();
        let nps = td.nodes.local() as f64 / seconds;

        if PRETTY {
            println!("{index:>3} {:>11} {seconds:>12.3}s {nps:>15.0} N/s", td.nodes.local());
        }
    }

    let seconds = time.elapsed().as_secs_f64();
    let nps = nodes as f64 / seconds;

    if PRETTY {
        println!("{}", "-".repeat(50));
        println!("{nodes:>15} {seconds:>12.3}s {nps:>15.0} N/s");
        println!("{}", "-".repeat(50));
    } else {
        let nps = nodes as f64 / seconds;
        println!("Bench: {nodes} nodes {nps:.0} nps");
    }

    crate::misc::dbg_print();
}
